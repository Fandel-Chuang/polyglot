# 多人工智能协作规则与流程（v1）

本文规范“主程序（Sonnet）+ GPT5（Infra/QA/Tooling）+ 其他协作智能”的协作方式，确保在多智能主体参与的前提下，高效、可追踪、可回滚。

一、目的
- 降低沟通成本：固定目录、固定文档格式、固定触发机制；
- 明确边界与优先级：谁负责什么、什么时候需要他人介入；
- 保证质量：CI 全流程、Golden 用例、变更即校验。

二、角色与职责
- 主程序（Sonnet）
  - 负责核心编译器/语言规则、Windows 兼容、中文/本地化策略落地；
  - 统一架构与决策，合入策略与版本发布；
  - 完成一次操作后：扫描 `人工智能协作/`，阅读 GPT 报告并处理。
- GPT5（Infra / QA / Tooling）
  - 负责 Debian/Linux CI、Golden 测试、工具链、脚手架、PR 规范；
  - 输出“工作汇报_*.md”，必要时提出选择项/请求决策；
  - 不处理 Windows 兼容问题（统一由主程序负责）。
- 其他智能（预留）
  - 遵循该规范进行输入/输出，避免直接变更主仓关键路径；
  - 提交前在“协作”目录同步说明与预期影响。

三、信息载体与触发机制
- 工作汇报（由 GPT5/他方提交）：`人工智能协作/工作汇报_主题_YYYY-MM-DD.md`
  - 主程序每次完成操作后自动扫描阅读；
  - 阅读后的汇报移动至 `人工智能协作/汇报历史/` 归档。
- 工作决定（仅当需要对方跟进时才创建）：`人工智能协作/工作决定_主题_YYYY-MM-DD.md`
  - 只在“需要 GPT5/他方配合处理”时下发，包含“任务清单/产出/截止/联系人”；
  - 纯主程序内部事项，不产生“工作决定”。
- 沟通说明/规范类文档
  - 长期有效的协作准则（如本文件、触发机制澄清）以独立文件形式存放；
  - 变更时更新版本号与变更点。

四、工作循环（主程序视角）
1) 需求/任务到来 → 在本地实现变更（代码/脚本/CI/用例）。
2) 变更完成 → 扫描 `人工智能协作/` → 阅读所有“未归档”的 `工作汇报_*` 并处理：
   - 若需要对方配合：创建 `工作决定_*` 明确任务与产出；
   - 若无需对方配合：直接落地，不创建“工作决定”。
3) 本地验证 → Golden 用例、CI 本地脚本、必要时人工抽查。
4) 提交与推送 → 遵循分支策略（见第六节）。
5) 文档与归档 → 将已读 `工作汇报_*` 移入 `汇报历史/`；必要时更新“日报/周报/发布说明”。

五、质量与测试
- Golden 测试
  - 过渡期：`tests/golden/`（已接入 CI）；
  - 规划路径：`自动化测试/金样测试/用例/`（由 GPT5主导迁移，提供兼容期与下线计划）。
- CI（每个 PR 与 main 推送）
  - Linux（gcc）+ Windows（MSVC）双平台编译与运行；
  - 产物：失败 diff、stderr/stdout、summary.json；
  - 约定：Windows 产物包含 `文达.exe` 与英文别名 `wenda_cn.exe`。
- 编译器运行模式
  - 支持 `--quiet`（安静模式）：仅输出“用户程序输出”，屏蔽编译日志；
  - 中文/本地化场景默认可用规则：
    - 文件名判定语种；
    - 中文文件名 + ASCII 内容 → 直接报错提示；
    - 中文文件名 + 本地化内容 → 加载 JSON 并规范化符号；
    - 英文文件名 → 默认 ASCII，不加载 JSON。

六、分支与合并策略
- 功能分支：`feature/<模块-主题>`；
- 合入 main：优先采用“cherry-pick/线性历史”，避免复杂 merge 提交；
- 大变更配合“发布说明（docs/releases）”与 tag 标记。

七、文档规范
- 协作目录：`人工智能协作/`
  - 汇报：`工作汇报_主题_YYYY-MM-DD.md`
  - 决定：`工作决定_主题_YYYY-MM-DD.md`（仅需他方配合时）
  - 归档：`汇报历史/`（移动已读汇报）
  - 规范：本文件与相关“沟通说明/*”
- 日报/周报：按需（主程序与 GPT5 各自维护），无需相互逐条确认。

八、冲突与优先级
- 规则冲突：以“主程序发布的语言/编译器规范”为准；
- 流程冲突：以“本文件版本最新”的流程为准；
- 紧急修复：主程序可直接在 main 上提交（需补充发布说明/变更摘要）。

九、演进与变更
- 本规范初版（v1），实践中滚动更新；
- 变更需在文件头标注版本与变更点，并在协作目录投递“沟通说明”。
