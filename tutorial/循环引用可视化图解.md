# å¾ªç¯å¼•ç”¨è§£å†³æ–¹æ¡ˆå¯è§†åŒ–å›¾è§£

## ğŸ”´ é—®é¢˜ï¼šå¾ªç¯å¼•ç”¨ä¾èµ–å›¾

```
åŸå§‹ç»“æ„ï¼ˆæœ‰é—®é¢˜ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  player.pg  â”‚â”€â”€â”€â”€â”€â”€import "enemy"â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚                         â”‚
â”‚ struct Player {                       â”‚
â”‚   target_enemy: Enemy                 â–¼
â”‚ }           â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  enemy.pg   â”‚
       â–²                       â”‚             â”‚
       â”‚                       â”‚ struct Enemy {
       â”‚                       â”‚   target_player: Player
       â””â”€â”€â”€â”€import "player"â”€â”€â”€â”€â”‚ }           â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœï¼šç¼–è¯‘å™¨é™·å…¥æ­»å¾ªç¯ï¼ âŒ
```

## âœ… è§£å†³æ–¹æ¡ˆï¼šæå–å…¬å…±æ¨¡å—

```
é‡æ„åç»“æ„ï¼ˆæ­£ç¡®ï¼‰ï¼š

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  common.pg   â”‚ â† å…¬å…±æ¨¡å—
                    â”‚              â”‚
                    â”‚ struct Vector3 {
                    â”‚   x, y, z: f32
                    â”‚ }            â”‚
                    â”‚              â”‚
                    â”‚ struct EntityId {
                    â”‚   value: i32
                    â”‚ }            â”‚
                    â”‚              â”‚
                    â”‚ interface GameEntity
                    â”‚ func calculate_damage()
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–²    â–²
                    â”Œâ”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”
             import â”‚                  â”‚ import
                    â”‚                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  player.pg  â”‚     â”‚  enemy.pg   â”‚
           â”‚             â”‚     â”‚             â”‚
           â”‚ struct Player {   â”‚ struct Enemy {
           â”‚   id: EntityId    â”‚   id: EntityId
           â”‚   target_enemy_id:â”‚   target_player_id:
           â”‚     EntityId      â”‚     EntityId
           â”‚ }           â”‚     â”‚ }           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²                 â–²
                    â”‚                 â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                          â”‚     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   main.pg   â”‚ â† åè°ƒæ¨¡å—
                    â”‚             â”‚
                    â”‚ import "common"
                    â”‚ import "player"
                    â”‚ import "enemy"
                    â”‚             â”‚
                    â”‚ func main() {
                    â”‚   // åè°ƒäº¤äº’
                    â”‚ }           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœï¼šæœ‰å‘æ— ç¯å›¾ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼ âœ…
```

## ğŸ“Š ç¼–è¯‘é¡ºåºå¯¹æ¯”

### âŒ é—®é¢˜åœºæ™¯çš„ç¼–è¯‘è¿‡ç¨‹
```
ç¼–è¯‘å™¨å°è¯•ç¼–è¯‘ player.pg
  â”œâ”€ éœ€è¦å…ˆç¼–è¯‘ enemy.pg
ç¼–è¯‘å™¨å°è¯•ç¼–è¯‘ enemy.pg
  â”œâ”€ éœ€è¦å…ˆç¼–è¯‘ player.pg â† æ­»é”ï¼
ç¼–è¯‘å™¨æŠ¥é”™ï¼šå¾ªç¯ä¾èµ–
```

### âœ… è§£å†³æ–¹æ¡ˆçš„ç¼–è¯‘è¿‡ç¨‹
```
æ­¥éª¤1: ç¼–è¯‘ common.pg âœ“
  â”œâ”€ æ— ä¾èµ–ï¼Œç›´æ¥ç¼–è¯‘æˆåŠŸ

æ­¥éª¤2: å¹¶è¡Œç¼–è¯‘ player.pg å’Œ enemy.pg âœ“
  â”œâ”€ player.pg ä¾èµ– common.pgï¼ˆå·²ç¼–è¯‘ï¼‰âœ“
  â””â”€ enemy.pg ä¾èµ– common.pgï¼ˆå·²ç¼–è¯‘ï¼‰âœ“

æ­¥éª¤3: ç¼–è¯‘ main.pg âœ“
  â”œâ”€ ä¾èµ– common.pgï¼ˆå·²ç¼–è¯‘ï¼‰âœ“
  â”œâ”€ ä¾èµ– player.pgï¼ˆå·²ç¼–è¯‘ï¼‰âœ“
  â””â”€ ä¾èµ– enemy.pgï¼ˆå·²ç¼–è¯‘ï¼‰âœ“

æ€»ç»“ï¼šç¼–è¯‘æˆåŠŸï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼
```

## ğŸ¯ å…³é”®è®¾è®¡æ¨¡å¼

### 1. ä¾èµ–å€’ç½®åŸåˆ™ (Dependency Inversion)
```
é«˜å±‚æ¨¡å— (main.pg) ä¸ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ç»†èŠ‚
     â†“
éƒ½ä¾èµ–æŠ½è±¡æ¥å£ (common.pg ä¸­çš„ interface)
     â†“
ä½å±‚æ¨¡å— (player.pg, enemy.pg) å®ç°è¿™äº›æ¥å£
```

### 2. IDå¼•ç”¨æ¨¡å¼ (Reference by ID)
```
ç›´æ¥å¼•ç”¨ (æœ‰é—®é¢˜):
Player â†’ Enemy (å¼ºè€¦åˆï¼Œå¯¼è‡´å¾ªç¯ä¾èµ–)

IDå¼•ç”¨ (è§£å†³æ–¹æ¡ˆ):
Player â†’ enemy_id: EntityId
éœ€è¦Enemyå¯¹è±¡æ—¶ â†’ é€šè¿‡æ¸¸æˆç³»ç»ŸæŸ¥æ‰¾
```

### 3. æ¥å£éš”ç¦» (Interface Segregation)
```
GameEntity æ¥å£:
â”œâ”€ get_id() â†’ æ ‡è¯†åŠŸèƒ½
â”œâ”€ get_position() â†’ ä½ç½®åŠŸèƒ½
â”œâ”€ get_health() â†’ ç”Ÿå‘½å€¼åŠŸèƒ½
â””â”€ take_damage() â†’ å—ä¼¤åŠŸèƒ½

Player å’Œ Enemy éƒ½å®ç°æ­¤æ¥å£ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†
```

## ğŸš€ å®é™…æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨

### æˆ˜æ–—ç³»ç»Ÿç¤ºä¾‹
```rust
// main.pg - æ¸¸æˆä¸»å¾ªç¯
func game_loop() {
    let entities = EntityManager::new()

    // åˆ›å»ºç©å®¶å’Œæ•Œäºº
    let player_id = entities.create_player(Vector3{x:0, y:0, z:0})
    let enemy_id = entities.create_enemy(Vector3{x:10, y:0, z:0})

    while game_running {
        // é€šè¿‡IDå®‰å…¨åœ°è·å–å¯¹è±¡
        if let player = entities.get_player(player_id) {
            if let enemy = entities.get_enemy(enemy_id) {
                // è®¡ç®—æˆ˜æ–—ï¼Œæ— å¾ªç¯ä¾èµ–
                battle_system(player, enemy)
            }
        }
    }
}
```

è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š
1. âœ… æ— å¾ªç¯ä¾èµ–
2. âœ… ä»£ç æ¸…æ™°æ˜“æ‡‚
3. âœ… ä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
4. âœ… æ”¯æŒä¿å­˜/åŠ è½½æ¸¸æˆï¼ˆåªéœ€ä¿å­˜IDï¼‰
5. âœ… æ”¯æŒç½‘ç»œåŒæ­¥ï¼ˆä¼ è¾“IDè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡ï¼‰