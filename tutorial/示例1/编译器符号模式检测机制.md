# polyglot ç¼–è¯‘å™¨ç¬¦å·æ¨¡å¼æ£€æµ‹æœºåˆ¶

## ğŸ” æ¦‚è¿°

polyglot ç¼–è¯‘å™¨å…·æœ‰æ™ºèƒ½çš„ç¬¦å·æ¨¡å¼æ£€æµ‹åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«æºä»£ç æ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŠè§’ç¬¦å·è¿˜æ˜¯å…¨è§’ç¬¦å·æ¨¡å¼ï¼Œå¹¶å¼ºåˆ¶æ•´ä¸ªæ–‡ä»¶ä¿æŒç¬¦å·ä¸€è‡´æ€§ã€‚è¿™ä¸€è®¾è®¡ç¡®ä¿äº†ä»£ç çš„æ¸…æ™°æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **ä¸€è‡´æ€§ä¿è¯** - é¿å…åŒä¸€æ–‡ä»¶å†…ç¬¦å·é£æ ¼æ··ä¹±
2. **å¯è¯»æ€§æå‡** - ç»Ÿä¸€çš„ç¬¦å·é£æ ¼ä½¿ä»£ç æ›´æ˜“é˜…è¯»
3. **ç»´æŠ¤ä¾¿åˆ©** - å‡å°‘å› ç¬¦å·ä¸ä¸€è‡´å¯¼è‡´çš„ç»´æŠ¤é—®é¢˜
4. **å›¢é˜Ÿåä½œ** - å¼ºåˆ¶å›¢é˜Ÿå†…ä¿æŒç»Ÿä¸€çš„ä»£ç é£æ ¼
5. **é”™è¯¯é¢„é˜²** - åœ¨ç¼–è¯‘é˜¶æ®µå°±å‘ç°ç¬¦å·ä¸ä¸€è‡´é—®é¢˜

## ğŸ“‹ æ£€æµ‹æœºåˆ¶

### ğŸ”¬ æ¨¡å¼è¯†åˆ«æµç¨‹

ç¼–è¯‘å™¨æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç¬¦å·æ¨¡å¼æ£€æµ‹ï¼š

1. **è¯æ³•åˆ†æé˜¶æ®µ** - æ‰«ææºä»£ç æ–‡ä»¶çš„æ‰€æœ‰token
2. **å…³é”®ç¬¦å·æ£€æµ‹** - è¯†åˆ«å…³é”®çš„è¯­æ³•ç¬¦å·
3. **æ¨¡å¼ç¡®å®š** - æ ¹æ®é¦–ä¸ªå…³é”®ç¬¦å·ç¡®å®šæ•´ä¸ªæ–‡ä»¶çš„æ¨¡å¼
4. **ä¸€è‡´æ€§éªŒè¯** - éªŒè¯åç»­æ‰€æœ‰ç¬¦å·æ˜¯å¦ç¬¦åˆå·²ç¡®å®šçš„æ¨¡å¼
5. **é”™è¯¯æŠ¥å‘Š** - å‘ç°ä¸ä¸€è‡´æ—¶ç”Ÿæˆè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### ğŸ¯ å…³é”®æ£€æµ‹ç¬¦å·

ç¼–è¯‘å™¨ä¸»è¦æ£€æµ‹ä»¥ä¸‹å…³é”®ç¬¦å·æ¥ç¡®å®šæ¨¡å¼ï¼š

| åŠŸèƒ½ | åŠè§’ç¬¦å· | å…¨è§’ç¬¦å· | ä¼˜å…ˆçº§ |
|------|----------|----------|---------|
| è¾“å‡ºè¯­å¥ | `>>` | `ã€‹ã€‹` | é«˜ |
| å˜é‡å£°æ˜ | `?` | `ï¼Ÿ` | é«˜ |
| è¿”å›è¯­å¥ | `<-` | `ï¼œï¼` | é«˜ |
| å‡½æ•°è¿”å›ç±»å‹ | `->` | `ï¼ã€‹` | é«˜ |
| ç»“æ„å®šä¹‰ | `@` | `ï¼ ` | ä¸­ |
| å®ç°å— | `&` | `ï¼†` | ä¸­ |
| æ¥å£å®šä¹‰ | `%` | `ï¼…` | ä¸­ |
| æšä¸¾å®šä¹‰ | `#` | `ï¼ƒ` | ä¸­ |
| èµ‹å€¼æ“ä½œ | `=` | `ï¼` | ä½ |
| æ¯”è¾ƒæ“ä½œ | `==`, `!=` | `ï¼ï¼`, `ï¼ï¼` | ä½ |

### ğŸš¦ æ£€æµ‹é€»è¾‘

```text
å¼€å§‹è§£ææ–‡ä»¶
    â†“
æ‰«æç¬¬ä¸€ä¸ªå…³é”®ç¬¦å·
    â†“
ç¡®å®šç¬¦å·æ¨¡å¼ (åŠè§’/å…¨è§’)
    â†“
é”å®šæ¨¡å¼ï¼Œç»§ç»­è§£æ
    â†“
æ£€æŸ¥æ¯ä¸ªåç»­ç¬¦å·
    â†“
ç¬¦å·åŒ¹é…æ¨¡å¼ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ç»§ç»­è§£æ
    â””â”€ å¦ â†’ ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œåœæ­¢ç¼–è¯‘
```

## âœ… æ­£ç¡®ä½¿ç”¨ç¤ºä¾‹

### åŠè§’æ¨¡å¼æ–‡ä»¶ç¤ºä¾‹

```polyglot
// æ–‡ä»¶ï¼šstudent_management.pg
// æ¨¡å¼ï¼šåŠè§’ç¬¦å·

@ Student {
    name: s,
    age: i,
    grade: f
}

& Student {
    Student(name: s, age: i, grade: f) {
        <- Student { name: name, age: age, grade: grade }
    }

    show_info() {
        >>("å­¦ç”Ÿå§“å: " + _.name)
        >>("å¹´é¾„: " + _.age)
        >>("æˆç»©: " + _.grade)
    }

    is_adult() -> b {
        <- _.age >= 18
    }
}

main() {
    ? student = Student("å¼ ä¸‰", 20, 85.5)
    student.show_info()

    (student.is_adult()) ? {
        >>("è¿™æ˜¯æˆå¹´å­¦ç”Ÿ")
    } : {
        >>("è¿™æ˜¯æœªæˆå¹´å­¦ç”Ÿ")
    }

    <- 0
}
```

### å…¨è§’æ¨¡å¼æ–‡ä»¶ç¤ºä¾‹

```polyglot
// æ–‡ä»¶ï¼šå­¦ç”Ÿç®¡ç†.pg
// æ¨¡å¼ï¼šå…¨è§’ç¬¦å·

ï¼  å­¦ç”Ÿ ï½›
    å§“åï¼š å­—ç¬¦ä¸²ï¼Œ
    å¹´é¾„ï¼š æ•´æ•°ï¼Œ
    æˆç»©ï¼š æµ®ç‚¹æ•°
ï½

ï¼† å­¦ç”Ÿ ï½›
    å­¦ç”Ÿï¼ˆå§“åï¼š å­—ç¬¦ä¸²ï¼Œ å¹´é¾„ï¼š æ•´æ•°ï¼Œ æˆç»©ï¼š æµ®ç‚¹æ•°ï¼‰ ï½›
        ï¼œï¼ å­¦ç”Ÿ ï½› å§“åï¼š å§“åï¼Œ å¹´é¾„ï¼š å¹´é¾„ï¼Œ æˆç»©ï¼š æˆç»© ï½
    ï½

    æ˜¾ç¤ºä¿¡æ¯ï¼ˆï¼‰ ï½›
        ã€‹ã€‹ï¼ˆ"å­¦ç”Ÿå§“åï¼š " ï¼‹ ï¼¿ï¼å§“åï¼‰
        ã€‹ã€‹ï¼ˆ"å¹´é¾„ï¼š " ï¼‹ ï¼¿ï¼å¹´é¾„ï¼‰
        ã€‹ã€‹ï¼ˆ"æˆç»©ï¼š " ï¼‹ ï¼¿ï¼æˆç»©ï¼‰
    ï½

    æ˜¯å¦æˆå¹´ï¼ˆï¼‰ ï¼ã€‹ å¸ƒå°” ï½›
        ï¼œï¼ ï¼¿ï¼å¹´é¾„ ã€‹ï¼ 18
    ï½
ï½

ä¸»å‡½æ•°ï¼ˆï¼‰ ï½›
    ï¼Ÿ å­¦ç”Ÿ ï¼ å­¦ç”Ÿï¼ˆ"å¼ ä¸‰"ï¼Œ 20ï¼Œ 85.5ï¼‰
    å­¦ç”Ÿï¼æ˜¾ç¤ºä¿¡æ¯ï¼ˆï¼‰

    ï¼ˆå­¦ç”Ÿï¼æ˜¯å¦æˆå¹´ï¼ˆï¼‰ï¼‰ï¼Ÿ ï½›
        ã€‹ã€‹ï¼ˆ"è¿™æ˜¯æˆå¹´å­¦ç”Ÿ"ï¼‰
    ï½ï¼š ï½›
        ã€‹ã€‹ï¼ˆ"è¿™æ˜¯æœªæˆå¹´å­¦ç”Ÿ"ï¼‰
    ï½

    ï¼œï¼ 0
ï½
```

## âŒ é”™è¯¯ä½¿ç”¨ç¤ºä¾‹

### æ··åˆæ¨¡å¼é”™è¯¯

```polyglot
// æ–‡ä»¶ï¼šmixed_error.pg - è¿™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯

main() {                    // åŠè§’æ¨¡å¼å¼€å§‹
    ? name = "å¼ ä¸‰"         // âœ… åŠè§’ç¬¦å·
    ? age = 20              // âœ… åŠè§’ç¬¦å·

    ã€‹ã€‹ï¼ˆ"å§“åï¼š " ï¼‹ nameï¼‰ // âŒ ç¼–è¯‘é”™è¯¯ï¼æ··ç”¨å…¨è§’ç¬¦å·
    >>("å¹´é¾„: " + age)      // âœ… åŠè§’ç¬¦å·

    <- 0                    // âœ… åŠè§’ç¬¦å·
}
```

### ç¼–è¯‘å™¨é”™è¯¯ä¿¡æ¯

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  polyglot ç¼–è¯‘å™¨é”™è¯¯æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

é”™è¯¯ç±»å‹ï¼šç¬¦å·æ¨¡å¼ä¸ä¸€è‡´
æ–‡ä»¶è·¯å¾„ï¼šmixed_error.pg
é”™è¯¯ä½ç½®ï¼šç¬¬ 6 è¡Œï¼Œç¬¬ 5 åˆ—

è¯¦ç»†ä¿¡æ¯ï¼š
  æ£€æµ‹åˆ°å…¨è§’è¾“å‡ºç¬¦å· 'ã€‹ã€‹'ï¼Œä½†æ–‡ä»¶å·²ç¡®å®šä¸ºåŠè§’æ¨¡å¼

ç¬¦å·æ¨¡å¼ä¿¡æ¯ï¼š
  âœ“ ç¡®å®šæ¨¡å¼ï¼šåŠè§’ç¬¦å· (åŸºäºç¬¬ 1 è¡Œçš„ 'main()')
  âŒ å†²çªç¬¦å·ï¼š'ã€‹ã€‹' (å…¨è§’è¾“å‡ºç¬¦å·)
  ğŸ“ å†²çªä½ç½®ï¼šç¬¬ 6 è¡Œ

ä¿®å¤å»ºè®®ï¼š
  1. å°† 'ã€‹ã€‹' æ”¹ä¸º '>>' ä»¥ä¿æŒåŠè§’æ¨¡å¼
  2. æˆ–è€…å°†æ•´ä¸ªæ–‡ä»¶è½¬æ¢ä¸ºå…¨è§’æ¨¡å¼

è½¬æ¢å‘½ä»¤ï¼š
  åŠè§’æ¨¡å¼ï¼špolyglot convert --to-halfwidth mixed_error.pg
  å…¨è§’æ¨¡å¼ï¼špolyglot convert --to-fullwidth mixed_error.pg

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## ğŸ”§ ç¼–è¯‘å™¨å·¥å…·

### æ¨¡å¼æ£€æµ‹å·¥å…·

```bash
# æ£€æŸ¥æ–‡ä»¶çš„ç¬¦å·æ¨¡å¼
polyglot check-mode <æ–‡ä»¶å>

# ç¤ºä¾‹è¾“å‡º
$ polyglot check-mode example.pg
æ–‡ä»¶ï¼šexample.pg
æ¨¡å¼ï¼šåŠè§’ç¬¦å·
æ£€æµ‹ä¾æ®ï¼šç¬¬ 1 è¡Œçš„ 'main()' ç¬¦å·
ç¬¦å·ç»Ÿè®¡ï¼š
  - åŠè§’ç¬¦å·ï¼š15 ä¸ª
  - å…¨è§’ç¬¦å·ï¼š0 ä¸ª
  - ä¸€è‡´æ€§ï¼šâœ“ é€šè¿‡
```

### æ¨¡å¼è½¬æ¢å·¥å…·

```bash
# è½¬æ¢ä¸ºåŠè§’æ¨¡å¼
polyglot convert --to-halfwidth <è¾“å…¥æ–‡ä»¶> [è¾“å‡ºæ–‡ä»¶]

# è½¬æ¢ä¸ºå…¨è§’æ¨¡å¼
polyglot convert --to-fullwidth <è¾“å…¥æ–‡ä»¶> [è¾“å‡ºæ–‡ä»¶]

# æ‰¹é‡è½¬æ¢ç›®å½•
polyglot convert --to-fullwidth --recursive src/

# è½¬æ¢å¹¶å¤‡ä»½åŸæ–‡ä»¶
polyglot convert --to-fullwidth --backup example.pg
```

### æ¨¡å¼éªŒè¯å·¥å…·

```bash
# éªŒè¯é¡¹ç›®ä¸­æ‰€æœ‰æ–‡ä»¶çš„ç¬¦å·ä¸€è‡´æ€§
polyglot validate-mode --recursive project/

# ç¤ºä¾‹è¾“å‡º
$ polyglot validate-mode --recursive src/
æ­£åœ¨éªŒè¯ç¬¦å·æ¨¡å¼ä¸€è‡´æ€§...

âœ“ src/main.pg           - åŠè§’æ¨¡å¼
âœ“ src/utils.pg          - åŠè§’æ¨¡å¼
âŒ src/chinese.pg        - æ¨¡å¼å†²çª (ç¬¬ 10 è¡Œ)
âœ“ src/lib/core.pg       - å…¨è§’æ¨¡å¼

å‘ç° 1 ä¸ªæ–‡ä»¶å­˜åœ¨ç¬¦å·æ¨¡å¼é—®é¢˜ã€‚
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é¡¹ç›®çº§ç»Ÿä¸€

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .polyglot é…ç½®æ–‡ä»¶
echo "symbol_mode: halfwidth" > .polyglot

# æˆ–è€…ä½¿ç”¨å…¨è§’æ¨¡å¼
echo "symbol_mode: fullwidth" > .polyglot
```

### 2. ç¼–è¾‘å™¨é›†æˆ

æ¨èçš„ç¼–è¾‘å™¨é…ç½®ï¼š

```json
// VS Code è®¾ç½®ç¤ºä¾‹
{
  "polyglot.symbolMode": "auto-detect",
  "polyglot.enforceConsistency": true,
  "polyglot.showModeIndicator": true,
  "polyglot.convertOnSave": false
}
```

### 3. å›¢é˜Ÿåä½œè§„èŒƒ

```yaml
# å›¢é˜Ÿä»£ç è§„èŒƒæ–‡ä»¶ï¼šteam_standards.yml
symbol_mode: halfwidth  # æˆ– fullwidth
enforcement: strict     # ä¸¥æ ¼æ¨¡å¼
auto_fix: false        # ä¸è‡ªåŠ¨ä¿®å¤ï¼Œè®©å¼€å‘è€…æ˜ç¡®é€‰æ‹©
ci_check: true         # CI/CD ä¸­è¿›è¡Œæ£€æŸ¥
```

### 4. Git é’©å­é›†æˆ

```bash
#!/bin/bash
# pre-commit é’©å­ç¤ºä¾‹
echo "æ£€æŸ¥ç¬¦å·æ¨¡å¼ä¸€è‡´æ€§..."
polyglot validate-mode --recursive src/
if [ $? -ne 0 ]; then
    echo "å‘ç°ç¬¦å·æ¨¡å¼ä¸ä¸€è‡´ï¼Œè¯·ä¿®å¤åå†æäº¤"
    exit 1
fi
```

## ğŸ’¡ é«˜çº§ç‰¹æ€§

### 1. æ™ºèƒ½æ¨¡å¼æ¨æ–­

ç¼–è¯‘å™¨å¯ä»¥åŸºäºé¡¹ç›®ä¸Šä¸‹æ–‡æ™ºèƒ½æ¨æ–­æ¨¡å¼ï¼š

```bash
# åŸºäºé¡¹ç›®ä¸­å…¶ä»–æ–‡ä»¶æ¨æ–­æ–°æ–‡ä»¶çš„æ¨¡å¼
polyglot new --infer-mode student.pg

# è¾“å‡ºï¼š
# æ£€æµ‹åˆ°é¡¹ç›®ä¸»è¦ä½¿ç”¨å…¨è§’æ¨¡å¼ï¼Œæ–°æ–‡ä»¶å°†é‡‡ç”¨å…¨è§’æ¨¡å¼
# å·²åˆ›å»ºï¼šstudent.pg (å…¨è§’æ¨¡å¼)
```

### 2. æ¸è¿›å¼è¿ç§»

```bash
# æ”¯æŒæ¸è¿›å¼ä»åŠè§’è¿ç§»åˆ°å…¨è§’
polyglot migrate --progressive --from-halfwidth --to-fullwidth src/

# ä¼šé€ä¸ªæ–‡ä»¶è½¬æ¢ï¼Œä¿æŒé¡¹ç›®å¯ç¼–è¯‘çŠ¶æ€
```

### 3. ç¬¦å·æ¨¡å¼åˆ†æ

```bash
# ç”Ÿæˆé¡¹ç›®ç¬¦å·ä½¿ç”¨æŠ¥å‘Š
polyglot analyze-symbols --recursive src/ --output report.html

# ç”Ÿæˆè¯¦ç»†çš„ç¬¦å·ä½¿ç”¨ç»Ÿè®¡å’Œå»ºè®®
```

## ğŸ” æŠ€æœ¯å®ç°ç»†èŠ‚

### è¯æ³•åˆ†æå™¨æ‰©å±•

```rust
// ä¼ªä»£ç ï¼šç¬¦å·æ¨¡å¼æ£€æµ‹çš„å®ç°
enum SymbolMode {
    HalfWidth,
    FullWidth,
    Undetermined,
}

struct ModeDetector {
    current_mode: SymbolMode,
    detection_history: Vec<DetectionPoint>,
}

impl ModeDetector {
    fn detect_symbol(&mut self, token: &Token) -> Result<(), ModeError> {
        let detected_mode = self.classify_symbol(token);

        match self.current_mode {
            SymbolMode::Undetermined => {
                self.current_mode = detected_mode;
                self.record_detection(token);
            },
            mode if mode == detected_mode => {
                // ç¬¦å·ä¸€è‡´ï¼Œç»§ç»­
            },
            _ => {
                return Err(ModeError::Inconsistent {
                    expected: self.current_mode,
                    found: detected_mode,
                    location: token.location,
                });
            }
        }
        Ok(())
    }
}
```

## ğŸ“Š æ€§èƒ½å½±å“

ç¬¦å·æ¨¡å¼æ£€æµ‹å¯¹ç¼–è¯‘æ€§èƒ½çš„å½±å“å¾®ä¹å…¶å¾®ï¼š

- **é¢å¤–æ—¶é—´**ï¼š< 1% çš„ç¼–è¯‘æ—¶é—´å¼€é”€
- **å†…å­˜ä½¿ç”¨**ï¼š< 0.1MB é¢å¤–å†…å­˜å ç”¨
- **æ£€æµ‹æ•ˆç‡**ï¼šO(n) æ—¶é—´å¤æ‚åº¦ï¼Œå…¶ä¸­ n æ˜¯tokenæ•°é‡

## ğŸŒŸ æ€»ç»“

polyglot çš„ç¬¦å·æ¨¡å¼æ£€æµ‹æœºåˆ¶æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ç‰¹æ€§ï¼Œå®ƒï¼š

1. **æå‡ä»£ç è´¨é‡** - å¼ºåˆ¶ç¬¦å·ä¸€è‡´æ€§
2. **æ”¹å–„å¼€å‘ä½“éªŒ** - åŠæ—¶å‘ç°å’Œä¿®å¤ç¬¦å·é—®é¢˜
3. **æ”¯æŒå›¢é˜Ÿåä½œ** - ç»Ÿä¸€å›¢é˜Ÿä»£ç é£æ ¼
4. **ä¿æŒå‘åå…¼å®¹** - æ”¯æŒç°æœ‰çš„åŠè§’ç¬¦å·ä»£ç 
5. **é¢å‘æœªæ¥** - ä¸ºæ›´å¤šç¬¦å·æ¨¡å¼æ‰©å±•ç•™ä¸‹ç©ºé—´

è¿™ä¸€æœºåˆ¶ä½¿ polyglot æˆä¸ºçœŸæ­£æ”¯æŒå¤šç§ç¼–ç é£æ ¼çš„ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼ŒåŒæ—¶ä¿æŒäº†ä»£ç çš„æ•´æ´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚