// ========================================
// ä½¿ç”¨è¿œç¨‹Gitä¾èµ–çš„ç¤ºä¾‹é¡¹ç›®
// Example project using remote Git dependencies
// ========================================

// å¯¼å…¥æ ‡å‡†åº“
>> "io/console"
>> "collections/array"
>> "math/math"

// å¯¼å…¥è¿œç¨‹Gitä¾èµ– - åŒ…ç®¡ç†å™¨ä¼šè‡ªåŠ¨ä¸‹è½½å’Œç®¡ç†è¿™äº›ä¾èµ–
>> "github.com/polyglot-community/http-client"      // HTTPå®¢æˆ·ç«¯åº“
>> "github.com/polyglot-community/json-parser"      // JSONè§£æåº“
>> "gitlab.com/awesome-org/data-structures"         // é«˜çº§æ•°æ®ç»“æ„
>> "github.com/user/graphics-lib/vector2d"          // 2Då›¾å½¢åº“

// ä½¿ç”¨æ¥è‡ªè¿œç¨‹ä¾èµ–çš„åŠŸèƒ½
main() {
    println_colored("ğŸš€ Polygloté¡¹ç›®ä¾èµ–ç®¡ç†ç¤ºä¾‹", Color::BLUE)
    println()

    // ç¤ºä¾‹1: ä½¿ç”¨HTTPå®¢æˆ·ç«¯
    test_http_client()

    // ç¤ºä¾‹2: ä½¿ç”¨JSONè§£æ
    test_json_parser()

    // ç¤ºä¾‹3: ä½¿ç”¨é«˜çº§æ•°æ®ç»“æ„
    test_data_structures()

    // ç¤ºä¾‹4: ä½¿ç”¨å›¾å½¢åº“
    test_graphics()

    <- 0
}

// ä½¿ç”¨HTTPå®¢æˆ·ç«¯åº“çš„ç¤ºä¾‹
test_http_client() {
    println_colored("ğŸ“¡ æµ‹è¯•HTTPå®¢æˆ·ç«¯", Color::GREEN)

    // å‡è®¾è¿™æ˜¯ä»github.com/polyglot-community/http-clientå¯¼å…¥çš„
    ? client = HttpClient()
    client.set_timeout(5000)  // 5ç§’è¶…æ—¶

    // å‘é€GETè¯·æ±‚
    ? response = client.get("https://api.github.com/repos/polyglot-lang/polyglot")

    (response.is_success()) ? {
        ? data = response.unwrap()
        println("âœ… HTTPè¯·æ±‚æˆåŠŸ:")
        println("   çŠ¶æ€ç : " + to_string(data.status_code))
        println("   å“åº”å¤§å°: " + to_string(data.body.length()) + " å­—èŠ‚")
    } : {
        println("âŒ HTTPè¯·æ±‚å¤±è´¥: " + response.unwrap_error())
    }
    println()
}

// ä½¿ç”¨JSONè§£æåº“çš„ç¤ºä¾‹
test_json_parser() {
    println_colored("ğŸ“ æµ‹è¯•JSONè§£æ", Color::GREEN)

    // å‡è®¾è¿™æ˜¯ä»github.com/polyglot-community/json-parserå¯¼å…¥çš„
    ? json_text = """
    {
        "name": "polyglot",
        "version": "1.0.0",
        "features": ["memory-safe", "symbol-syntax", "chinese-support"],
        "stats": {
            "lines_of_code": 50000,
            "contributors": 25
        }
    }
    """

    ? parse_result = JsonParser::parse(json_text)
    (parse_result.is_success()) ? {
        ? json_obj = parse_result.unwrap()

        println("âœ… JSONè§£ææˆåŠŸ:")
        println("   é¡¹ç›®å: " + json_obj.get_string("name").unwrap())
        println("   ç‰ˆæœ¬: " + json_obj.get_string("version").unwrap())

        ? features = json_obj.get_array("features").unwrap()
        println("   ç‰¹æ€§æ•°é‡: " + to_string(features.length()))

        ? stats = json_obj.get_object("stats").unwrap()
        ? loc = stats.get_number("lines_of_code").unwrap()
        println("   ä»£ç è¡Œæ•°: " + to_string(loc as i32))
    } : {
        println("âŒ JSONè§£æå¤±è´¥: " + parse_result.unwrap_error())
    }
    println()
}

// ä½¿ç”¨é«˜çº§æ•°æ®ç»“æ„çš„ç¤ºä¾‹
test_data_structures() {
    println_colored("ğŸ—ï¸ æµ‹è¯•é«˜çº§æ•°æ®ç»“æ„", Color::GREEN)

    // å‡è®¾è¿™æ˜¯ä»gitlab.com/awesome-org/data-structureså¯¼å…¥çš„
    ? trie = Trie<string>()  // å‰ç¼€æ ‘

    // æ·»åŠ ä¸€äº›ä¸­æ–‡è¯æ±‡
    ? words = ["ä½ å¥½", "ä¸–ç•Œ", "ç¼–ç¨‹", "è¯­è¨€", "æ–‡è¾¾", "polyglot"]
    ^(word in words) {
        trie.insert(word, word + "_data")
    }

    println("âœ… å‰ç¼€æ ‘æ„å»ºå®Œæˆ:")
    println("   è¯æ±‡æ•°é‡: " + to_string(trie.size()))

    // æµ‹è¯•å‰ç¼€æœç´¢
    ? prefix_results = trie.find_with_prefix("ç¼–")
    println("   ä»¥'ç¼–'å¼€å¤´çš„è¯: " + to_string(prefix_results.length()))

    // ä½¿ç”¨äºŒå‰æœç´¢æ ‘
    ? bst = BinarySearchTree<i32>()
    ? numbers = [42, 17, 99, 3, 64, 28, 81]
    ^(num in numbers) {
        bst.insert(num)
    }

    println("   äºŒå‰æœç´¢æ ‘èŠ‚ç‚¹æ•°: " + to_string(bst.size()))
    println("   æ ‘çš„é«˜åº¦: " + to_string(bst.height()))
    println()
}

// ä½¿ç”¨2Då›¾å½¢åº“çš„ç¤ºä¾‹
test_graphics() {
    println_colored("ğŸ¨ æµ‹è¯•2Då›¾å½¢åº“", Color::GREEN)

    // å‡è®¾è¿™æ˜¯ä»github.com/user/graphics-lib/vector2då¯¼å…¥çš„
    ? point1 = Point2D(10.0, 20.0)
    ? point2 = Point2D(30.0, 40.0)

    ? distance = point1.distance_to(point2)
    println("âœ… 2Då›¾å½¢è®¡ç®—:")
    println("   ç‚¹1: " + point1.to_string())
    println("   ç‚¹2: " + point2.to_string())
    println("   è·ç¦»: " + to_string(distance))

    // åˆ›å»ºå½¢çŠ¶
    ? rectangle = Rectangle(point1, 50.0, 30.0)
    ? circle = Circle(point2, 15.0)

    println("   çŸ©å½¢é¢ç§¯: " + to_string(rectangle.area()))
    println("   åœ†å½¢é¢ç§¯: " + to_string(circle.area()))

    // ç¢°æ’æ£€æµ‹
    ? collision = rectangle.intersects(circle)
    println("   ç¢°æ’æ£€æµ‹: " + (collision ? "ç›¸äº¤" : "ä¸ç›¸äº¤"))
    println()
}

// é”™è¯¯å¤„ç†ç¤ºä¾‹
handle_dependency_error() {
    println_colored("âš ï¸ ä¾èµ–é”™è¯¯å¤„ç†ç¤ºä¾‹", Color::YELLOW)

    // å¦‚æœä¾èµ–ä¸å¯ç”¨ï¼Œæä¾›é™çº§æ–¹æ¡ˆ
    ? fallback_result = try_load_dependency("github.com/optional/feature")

    (fallback_result.is_error()) ? {
        println("ä¾èµ–åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å†…ç½®å®ç°...")
        use_builtin_implementation()
    } : {
        println("ä¾èµ–åŠ è½½æˆåŠŸï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹å®ç°...")
        use_third_party_implementation()
    }
}

use_builtin_implementation() {
    println("ä½¿ç”¨å†…ç½®çš„åŸºç¡€åŠŸèƒ½")
}

use_third_party_implementation() {
    println("ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„é«˜çº§åŠŸèƒ½")
}